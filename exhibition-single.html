<!DOCTYPE html>
<html lang="en">

<head>
    <title>Museum Mate - 전시회 상세 조회</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" href="assets/img/apple-icon.png">
    <link rel="shortcut icon" type="image/x-icon" href="assets/img/favicon.ico">
    <!-- Load Require CSS -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font CSS -->
    <link href="assets/css/boxicon.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- Load Tempalte CSS -->
    <link rel="stylesheet" href="assets/css/templatemo.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/custom.css">


</head>

<body>
    <!-- Header -->
    <nav id="main_nav" class="navbar navbar-expand-lg navbar-light bg-white shadow">
        <div class="container d-flex justify-content-between align-items-center">
            <a class="navbar-brand h1" href="index.html">
                <i class='bx bx-buildings bx-sm text-dark'></i>
                <span class="text-dark h4">MUMA</span> <span class="text-primary h5">Museum Mate</span>
            </a>
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbar-toggler-success" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="align-self-center collapse navbar-collapse flex-fill  d-lg-flex justify-content-lg-between"
                id="navbar-toggler-success">
                <div class="flex-fill mx-xl-5 mb-2">
                    <ul class="nav navbar-nav d-flex justify-content-between mx-xl-5 text-center text-dark">
                        <li class="nav-item">
                            <a class="nav-link btn-outline-primary rounded-pill px-3" href="index.html">홈</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link btn-outline-primary rounded-pill px-3" href="exhibition.html">전시회</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link btn-outline-primary rounded-pill px-3" href="pricing.html">함께 보러 가요</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link btn-outline-primary rounded-pill px-3" href="about.html">team MUMA</a>
                        </li>
                    </ul>
                </div>
                <div class="navbar align-self-center d-flex">
                    <a class="nav-link" href="#"><i class='bx bx-bell bx-sm bx-tada-hover text-primary'></i></a>
                    <a class="nav-link" href="#"><i class='bx bx-cog bx-sm text-primary'></i></a>
                    <a class="nav-link" href="#"><i class='bx bx-user-circle bx-sm text-primary'></i></a>
                </div>
            </div>
        </div>
    </nav>
    <!-- Close Header -->


    <!-- 스타트 배너 -->
    <div id="index_banner" class="bg-light w-100">
        <div
            class="container-fluid text-light d-flex justify-content-center align-items-center border-0 rounded-0 p-0 py-5">
            <div class="banner-content col-lg-8 m-lg-auto text-center py-5 px-3">
                <h1 class="banner-heading h2 pb-5 typo-space-line-center">전시회 상세 조회</<h1>
                </h1>
                <h3 class="h4 pb-2 light-300">전시회에 대한 모든 것</h3>
                <p class="banner-footer light-300">
                    전시회에 대한 자세한 정보를 찾아 보세요!
                </p>
            </div>
        </div>
    </div>
    <!-- 스타트 배너 끝 -->


    <!-- 상세조회 화면 구성 -->
    <section id="exhibition-container" class="container py-5">

    </section>


    <!-- 리뷰 기능 -->
    <section  class="container py-5">

        <!-- Start Comment -->
        <div class="row justify-content-center">
            <div class="worksingle-comment-heading col-8 m-auto pb-3">
                <h4 class="worksingle-comment-heading h4 pb-3 mt-3 fw-bold light-300 typo-space-line">리뷰</h4>
            </div>
        </div>
        <div id="comment-container">

        </div>

        <!-- 리뷰 등록 -->
        <div class="row pb-4">
            <div class="worksingle-comment-footer col-lg-8 m-auto">
                <h4 class="worksingle-comment-heading h4 pb-3 mt-3 fw-bold light-300 typo-space-line">리뷰 등록</h4>
                <!-- <form class="col-md-12 m-auto" method="POST" action="#" role="form"> -->

                <div class="form-group mt-3">
                    <textarea class="form-control form-control-lg light-300" id="inputtitle" name="inputtitle" placeholder="제목을 입력하세요" rows="1"></textarea>
                    <textarea class="form-control form-control-lg light-300" id="inputmessage" name="inputmessage" placeholder="내용을 입력하세요" rows="5"></textarea>
                </div>
                <select id="starValue">
                    <option value="1">&#11088;</option>
                    <option value="2">&#11088;&#11088;</option>
                    <option value="3">&#11088;&#11088;&#11088;</option>
                    <option value="4">&#11088;&#11088;&#11088;&#11088;</option>
                    <option value="5">&#11088;&#11088;&#11088;&#11088;&#11088;</option>
                </select>

                <div class="form-row pt-2">
                    <div class="col-md-12 col-10 text-end">
                        <button type="button" onclick=postWithAuth() class="btn btn-secondary text-white px-md-4 px-2 py-md-3 py-1 radius-0 light-300">리뷰 등록</button>
                    </div>
                </div>
                <!-- </form> -->
            </div>
        </div>


        <!-- End Comment Form -->
    </section>

    <!-- End Work Sigle -->

    <!-- Start Footer -->
    <footer class="bg-secondary pt-4">
        <div class="container">
            <div class="row py-4">

                <div class="col-lg-3 col-12 align-left">
                    <a class="navbar-brand" href="index.html">
                        <i class='bx bx-buildings bx-sm text-light'></i>
                        <span class="text-light h5">Purple</span> <span class="text-light h5 semi-bold-600">Buzz</span>
                    </a>
                    <p class="text-light my-lg-4 my-2">
                        Lorem ipsum dolor sit amet, consectetur adipisicing elit,
                        sed do eiusmod tempor incididunt ut.
                    </p>
                    <ul class="list-inline footer-icons light-300">
                        <li class="list-inline-item m-0">
                            <a class="text-light" target="_blank" href="http://facebook.com/">
                                <i class='bx bxl-facebook-square bx-md'></i>
                            </a>
                        </li>
                        <li class="list-inline-item m-0">
                            <a class="text-light" target="_blank" href="https://www.linkedin.com/">
                                <i class='bx bxl-linkedin-square bx-md'></i>
                            </a>
                        </li>
                        <li class="list-inline-item m-0">
                            <a class="text-light" target="_blank" href="https://www.whatsapp.com/">
                                <i class='bx bxl-whatsapp-square bx-md'></i>
                            </a>
                        </li>
                        <li class="list-inline-item m-0">
                            <a class="text-light" target="_blank" href="https://www.flickr.com/">
                                <i class='bx bxl-flickr-square bx-md'></i>
                            </a>
                        </li>
                        <li class="list-inline-item m-0">
                            <a class="text-light" target="_blank" href="https://www.medium.com/">
                                <i class='bx bxl-medium-square bx-md'></i>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="col-lg-3 col-md-4 my-sm-0 mt-4">
                    <h3 class="h4 pb-lg-3 text-light light-300">Our Company</h2>
                        <ul class="list-unstyled text-light light-300">
                            <li class="pb-2">
                                <i class='bx-fw bx bxs-chevron-right bx-xs'></i><a
                                    class="text-decoration-none text-light" href="index.html">Home</a>
                            </li>
                            <li class="pb-2">
                                <i class='bx-fw bx bxs-chevron-right bx-xs'></i><a
                                    class="text-decoration-none text-light py-1" href="about.html">About Us</a>
                            </li>
                            <li class="pb-2">
                                <i class='bx-fw bx bxs-chevron-right bx-xs'></i><a
                                    class="text-decoration-none text-light py-1" href="exhibition.html">Work</a>
                            </li>
                            <li class="pb-2">
                                <i class='bx-fw bx bxs-chevron-right bx-xs'></i></i><a
                                    class="text-decoration-none text-light py-1" href="pricing.html">Price</a>
                            </li>
                            <li class="pb-2">
                                <i class='bx-fw bx bxs-chevron-right bx-xs'></i><a
                                    class="text-decoration-none text-light py-1" href="contact.html">Contact</a>
                            </li>
                        </ul>
                </div>

                <div class="col-lg-3 col-md-4 my-sm-0 mt-4">
                    <h2 class="h4 pb-lg-3 text-light light-300">Our Works</h2>
                    <ul class="list-unstyled text-light light-300">
                        <li class="pb-2">
                            <i class='bx-fw bx bxs-chevron-right bx-xs'></i><a
                                class="text-decoration-none text-light py-1" href="#">Branding</a>
                        </li>
                        <li class="pb-2">
                            <i class='bx-fw bx bxs-chevron-right bx-xs'></i><a
                                class="text-decoration-none text-light py-1" href="#">Business</a>
                        </li>
                        <li class="pb-2">
                            <i class='bx-fw bx bxs-chevron-right bx-xs'></i><a
                                class="text-decoration-none text-light py-1" href="#">Marketing</a>
                        </li>
                        <li class="pb-2">
                            <i class='bx-fw bx bxs-chevron-right bx-xs'></i><a
                                class="text-decoration-none text-light py-1" href="#">Social Media</a>
                        </li>
                        <li class="pb-2">
                            <i class='bx-fw bx bxs-chevron-right bx-xs'></i><a
                                class="text-decoration-none text-light py-1" href="#">Digital Solution</a>
                        </li>
                        <li class="pb-2">
                            <i class='bx-fw bx bxs-chevron-right bx-xs'></i><a
                                class="text-decoration-none text-light py-1" href="#">Graphic</a>
                        </li>
                    </ul>
                </div>

                <div class="col-lg-3 col-md-4 my-sm-0 mt-4">
                    <h2 class="h4 pb-lg-3 text-light light-300">For Client</h2>
                    <ul class="list-unstyled text-light light-300">
                        <li class="pb-2">
                            <i class='bx-fw bx bx-phone bx-xs'></i><a class="text-decoration-none text-light py-1"
                                href="tel:010-020-0340">010-020-0340</a>
                        </li>
                        <li class="pb-2">
                            <i class='bx-fw bx bx-mail-send bx-xs'></i><a class="text-decoration-none text-light py-1"
                                href="mailto:info@company.com">info@company.com</a>
                        </li>
                    </ul>
                </div>

            </div>
        </div>

        <div class="w-100 bg-primary py-3">
            <div class="container">
                <div class="row pt-2">
                    <div class="col-lg-6 col-sm-12">
                        <p class="text-lg-start text-center text-light light-300">
                            © Copyright 2021 Purple Buzz Company. All Rights Reserved.
                        </p>
                    </div>
                    <div class="col-lg-6 col-sm-12">
                        <p class="text-lg-end text-center text-light light-300">
                            Designed by <a rel="sponsored" class="text-decoration-none text-light"
                                href="https://templatemo.com/" target="_blank"><strong>TemplateMo</strong></a>
                        </p>
                    </div>
                </div>
            </div>
        </div>

    </footer>
    <!-- End Footer -->


    <!-- Bootstrap -->
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <!-- Load jQuery require for Page Script -->
    <script src="assets/js/jquery.min.js"></script>
    <!-- Page Script -->
    <script>
        $(window).load(function () {
            // Slide
            $('.templatemo-slide-link').click(function () {
                var this_href = $(this).attr('href');
                $('#templatemo-slide-link-target img').attr('src', this_href);
                return false;
            });
            // End Slide
        });
    </script>
    <!-- Templatemo -->
    <script src="assets/js/templatemo.js"></script>
    <!-- Custom -->
    <script src="assets/js/custom.js"></script>


    <!-- 전체 페이지 구성 -->
    <script>
        const queryString = window.location.href.split('?')[1]
        const id = queryString.split('=')[1]
        console.log(window.localStorage.getItem('token'))
        fetch(`http://localhost:8080/api/v1/exhibitions/${id}`)
            .then(res => res.json())
            .then(contents => {
                console.log(contents.result)
                const html = `
            <div class="row pt-5">
                <div class="worksingle-content col-lg-8 m-auto text-left justify-content-center">
                    <h2 class="worksingle-heading h3 fw-bold pb-3 light-300 typo-space-line">${contents.result.name}</h2><br>
                
                    <div id="div_root">
                        <div id="div_img">
                            <div><img src=${contents.result.mainImgUrl} /></div>
                            
                        </div>
                        <div id="div_spec">
                            <h6 class>장소&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ${contents.result.galleryLocation}<h6><br>
                            <h6 class>기간&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ${contents.result.startAt} ~ ${contents.result.endAt}<h6><br>
                            <h6 class>관람연령 &nbsp;&nbsp;${contents.result.ageLimit}<h6><br>
                            <h6 class>가격&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ${contents.result.price}<h6><br>
                            <div>
                                <span style=''>&#128278;</span><button id="bookmarkBtn" style="margin-left:1rem; border:none;">북마크</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="worksingle-content col-lg-8 m-auto mt-5 text-left justify-content-center">
                    <h4 class="worksingle-heading h4 pb-3 fw-bold light-300 typo-space-line">공지사항</h4>
                        <p>${contents.result.detailInfo}</p>
                </div>

                <div class="worksingle-content col-lg-8 m-auto text-left justify-content-center">
                    <h4 class="worksingle-heading h4 pb-3 fw-bold light-300 typo-space-line">상세정보</h4>
                <div><img src=${contents.result.detailInfoImgUrl.split(',')[0]} /></div>
                </div>
                           
                <div class="worksingle-content col-lg-8 m-auto mt-3 text-left justify-content-center">
                    <h4 class="worksingle-heading h4 pb-3 fw-bold light-300 typo-space-line">안내사항</h4>
                        <p>${contents.result.notice}</p>
                        <div>${
                            contents.result.noticeImgUrl 
                                ? '<img src="' + contents.result.noticeImgUrl.split(',')[0] + '" />'
                                : '<div>no image</div>'
                        }</div>
                </div>
                
            </div>
            `

                const div = document.getElementById('exhibition-container')
                div.innerHTML = html;

                const token = window.localStorage.getItem('token')
                const queryString1 = window.location.href.split('?')[1]
                const id1 = queryString.split('=')[1]
                const btn = document.getElementById('bookmarkBtn')
                console.log(token)
                btn.addEventListener('click', function() {
                    fetch(`http://localhost:8080/api/v1/exhibitions/${id1}/bookmarks`, {
                        method: 'POST',
                        mode: 'cors',
                        headers: {
                            'Content-Type': 'application/json',
                            "Authorization": `Bearer ${token}`
                        },
                    }).then((res) => res.json())
                    .then((res) => {
                        console.log(res.result)
                    })
                    .catch(err => {
                        console.log(err)
                    }) 
                })
            })

        const queryString1 = window.location.href.split('?')[1]
        const id1 = queryString.split('=')[1]
        fetch(`http://localhost:8080/api/v1/reviews/${id1}/reviews`)
            .then(res => res.json())
            .then(contents => {
                let html = ''
                for (const content of contents.result.content) {
                    html += `
                        <div class="row pb-4">
                        <div class="worksingle-comment-body col-md-8 m-auto">
                            <div class="d-flex">
                                <div class="comment-body">
                                        <div class="comment-header d-flex justify-content-between ms-3">
                                            <div class="header text-start">
                                                <div class="h6">${content.userName} ${
                                                        // content.star
                                                        Array.from({ length: content.star }, (_, i) => `<span style=''>&#11088;</span>`).join('')
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                        <div class="footer" style="width: 53rem;">
                                            <div class="card-body border ms-3 light-300">
                                                <div class= "card-title fw-bold">${content.title}</div>
                                                <div class= m-auto mt-4>${content.content}</div>
                                            </div>
                                            <div style = text-align:right>
                                            <p class="text-muted light-300">${content.createdAt}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `
                }
                
                const div = document.getElementById('comment-container')
                div.innerHTML = html;
            })
    </script>


   
<script>
    async function postWithAuth() {
    // let url = base_url + detail_url;
    const queryStrings = window.location.href.split('?')[1];
    let id = 1;
    for (const query of queryStrings.split('&')) {
        if (query[0] === 'id') {
            id = query[1]
        }
    }
    const textArea1 = document.getElementById('inputtitle')
    const textArea = document.getElementById('inputmessage')
    const selectedStar = document.getElementById('starValue')
    try {
        let res = await fetch(`http://localhost:8080/api/v1/reviews/${id}`, {
            method: 'post',
            mode: 'cors',
            headers: {
                'Content-Type': 'application/json',
                "Authorization": `Bearer eyJhbGciOiJIUzI1NiJ9.eyJlbWFpbCI6InRlc3RAdGVzdC50ZXN0IiwiaWF0IjoxNjc2MjYxOTU5LCJleHAiOjE2NzYyNjU1NTl9.LIQeXAnDflDBDkAmb9KpbAHQCy-kMsAnwqvc95dOo_Q`
            },
            body: JSON.stringify({
                title: textArea1.value,
                content: textArea.value,
                star: selectedStar.value,
                visitedDate: new Date()
            })
        });
        if(res.status!=200){
            alert(await res.json())
        }
        return await res.status;
    } catch (error) {
        console.log(error);
        alert("Request Error!");
    }
}
</script>
</body>

</html>